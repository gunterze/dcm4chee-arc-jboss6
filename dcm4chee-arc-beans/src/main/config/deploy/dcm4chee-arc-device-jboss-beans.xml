<?xml version="1.0" encoding="UTF-8"?>
<!-- ***** BEGIN LICENSE BLOCK *****
   - Version: MPL 1.1/GPL 2.0/LGPL 2.1
   -
   - The contents of this file are subject to the Mozilla Public License Version
   - 1.1 (the "License"); you may not use this file except in compliance with
   - the License. You may obtain a copy of the License at
   - http://www.mozilla.org/MPL/
   -
   - Software distributed under the License is distributed on an "AS IS" basis,
   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
   - for the specific language governing rights and limitations under the
   - License.
   -
   - The Original Code is part of dcm4che, an implementation of DICOM(TM) in
   - Java(TM), hosted at https://github.com/gunterze/dcm4che.
   -
   - The Initial Developer of the Original Code is
   - Agfa Healthcare.
   - Portions created by the Initial Developer are Copyright (C) 2011
   - the Initial Developer. All Rights Reserved.
   -
   - Contributor(s):
   - Gunter Zeilinger <gunterze@gmail.com>
   -
   - Alternatively, the contents of this file may be used under the terms of
   - either the GNU General Public License Version 2 or later (the "GPL"), or
   - the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
   - in which case the provisions of the GPL or the LGPL are applicable instead
   - of those above. If you wish to allow use of your version of this file only
   - under the terms of either the GPL or the LGPL, and not to allow others to
   - use your version of this file under the terms of the MPL, indicate your
   - decision by deleting the provisions above and replace them with the notice
   - and other provisions required by the GPL or the LGPL. If you do not delete
   - the provisions above, a recipient may use your version of this file under
   - the terms of any one of the MPL, the GPL or the LGPL.
   -
   - ***** END LICENSE BLOCK *****  -->

<deployment xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="urn:jboss:bean-deployer bean-deployer_2_0.xsd"
  xmlns="urn:jboss:bean-deployer:2.0">

  <bean name="Executer" class="java.util.concurrent.Executor">
    <constructor factoryClass="java.util.concurrent.Executors"
      factoryMethod="newCachedThreadPool" />
  </bean>

  <bean name="ScheduledExecutorService" class="java.util.concurrent.ScheduledExecutorService">
    <constructor factoryClass="java.util.concurrent.Executors"
      factoryMethod="newSingleThreadScheduledExecutor" />
  </bean>

  <bean name="True" class="java.lang.Boolean">
    <constructor factoryClass="java.lang.Boolean" factoryMethod="valueOf">
      <parameter>true</parameter>
    </constructor>
  </bean>

  <bean name="False" class="java.lang.Boolean">
    <constructor factoryClass="java.lang.Boolean" factoryMethod="valueOf">
      <parameter>false</parameter>
    </constructor>
  </bean>

  <!-- Store Param -->
  <bean name="StoreParam" class="org.dcm4chee.archive.persistence.StoreParam">
    <property name="patientAttributes">
      <array>
         <value>524293</value> <!-- SpecificCharacterSet (0008,0005) -->
         <value>1048592</value> <!-- PatientName (0010,0010) -->
         <value>1048608</value> <!-- PatientID (0010,0020) -->
         <value>1048609</value> <!-- IssuerOfPatientID (0010,0021) -->
         <value>1052674</value> <!-- OtherPatientIDSequence (0010,1002) -->
         <value>1048624</value> <!-- PatientBirthDate (0010,0030) -->
         <value>1048640</value> <!-- PatientSex (0010,0040) -->
         <value>1064960</value> <!-- PatientComments (0010,4000) -->
      </array>
    </property>
    <property name="studyAttributes">
      <array>
         <value>524293</value> <!-- SpecificCharacterSet (0008,0005) -->
         <value>524320</value> <!-- StudyDate (0008,0020) -->
         <value>524336</value> <!-- StudyTime (0008,0030) -->
         <value>524368</value> <!-- AccessionNumber (0008,0050) -->
         <value>524369</value> <!-- IssuerOfAccessionNumberSequence (0008,0051) -->
         <value>524432</value> <!-- ReferringPhysicianName (0008,0090) -->
         <value>528432</value> <!-- StudyDescription (0008,1030) -->
         <value>528434</value> <!-- ProcedureCodeSequence (0008,1032) -->
         <value>1048589</value> <!-- StudyInstanceUID (0020,000D) -->
         <value>1048592</value> <!-- StudyID (0020,0010) -->
      </array>
    </property>
    <property name="seriesAttributes">
      <array>
         <value>524293</value> <!-- SpecificCharacterSet (0008,0005) -->
         <value>524384</value> <!-- Modality (0008,0060) -->
         <value>524400</value> <!-- Manufacturer (0008,0070) -->
         <value>524416</value> <!-- InstitutionName (0008,0080) -->
         <value>524418</value> <!-- InstitutionCodeSequence (0008,0082) -->
         <value>528400</value> <!-- StationName (0008,1010) -->
         <value>528446</value> <!-- SeriesDescription (0008,103E) -->
         <value>528448</value> <!-- InstitutionalDepartmentName (0008,1040) -->
         <value>528464</value> <!-- PerformingPhysicianName (0008,1050) -->
         <value>528528</value> <!-- ManufacturerModelName (0008,1090) -->
         <value>528657</value> <!-- ReferencedPerformedProcedureStepSequence (0008,1111) -->
         <value>1572885</value> <!-- BodyPartExamined (0018,0015) -->
         <value>2097166</value> <!-- SeriesInstanceUID (0020,000E) -->
         <value>2097169</value> <!-- SeriesNumber (0020,0011) -->
         <value>2097248</value> <!-- Laterality (0020,0060) -->
         <value>4194884</value> <!-- PerformedProcedureStep StartDate (0040,0244) -->
         <value>4194885</value> <!-- PerformedProcedureStepStartTime (0040,0245) -->
         <value>4194933</value> <!-- RequestAttributesSequence (0040,0275) -->
      </array>
    </property>
    <property name="instanceAttributes">
      <array>
         <value>524293</value> <!-- SpecificCharacterSet (0008,0005) -->
         <value>524296</value> <!-- Image Type (0008,0008) -->
         <value>524310</value> <!-- SOPClassUID (0008,0016) -->
         <value>524312</value> <!-- SOPInstanceUID (0008,0018) -->
         <value>524322</value> <!-- AcquisitionDate (0008,0022) -->
         <value>524323</value> <!-- ContentDate (0008,0023) -->
         <value>524330</value> <!-- AcquisitionDateTime (0008,002A) -->
         <value>524338</value> <!-- AcquisitionTime (0008,0032) -->
         <value>524339</value> <!-- ContentTime (0008,0033) -->
         <value>528661</value> <!-- ReferencedSeriesSequence (0008,1115) -->
         <value>2097171</value> <!-- InstanceNumber (0020,0013) -->
         <value>2621444</value> <!-- PhotometricInterpretation (0028,0004) -->
         <value>2621448</value> <!-- NumberOfFrames (0028,0008) -->
         <value>2621456</value> <!-- Rows (0028,0010) -->
         <value>2621457</value> <!-- Columns (0028,0011) -->
         <value>2621696</value> <!-- BitsAllocated (0028,0100) -->
         <value>4235314</value> <!-- ObservationDateTime (0040,A032) -->
         <value>4235331</value> <!-- ConceptNameCodeSequence (0040,A043) -->
         <value>4235379</value> <!-- VerifyingObserverSequence (0040,A073) -->
         <value>4236144</value> <!-- ReferencedRequestSequence (0040,A370) -->
         <value>4236149</value> <!-- CurrentRequestedProcedureEvidenceSequence (0040,A375) -->
         <value>4236165</value> <!-- PertinentOtherEvidenceSequence (0040,A385) -->
         <value>4236433</value> <!-- CompletionFlag (0040,A491) -->
         <value>4236435</value> <!-- VerificationFlag (0040,A493) -->
         <value>4236581</value> <!-- IdenticalDocumentsSequence (0040,A525) -->
         <value>4325392</value> <!-- DocumentTitle (0042,0010) -->
         <value>4325394</value> <!-- MIMETypeOfEncapsulatedDocument (0042,0012) -->
         <value>7340160</value> <!-- ContentLabel (0070,0080) -->
         <value>7340161</value> <!-- ContentDescription (0070,0081) -->
         <value>7340162</value> <!-- PresentationCreationDate (0070,0082) -->
         <value>7340163</value> <!-- PresentationCreationTime (0070,0083) -->
         <value>7340164</value> <!-- ContentCreatorName (0070,0084) -->
         <value>67110241</value> <!-- OriginalAttributesSequence (0400,0561) -->
      </array>
    </property>
    <property name="fuzzyStr">
      <bean name="FuzzyStr" class="org.dcm4che.soundex.ESoundex" />
    </property>
    <property name="storeDuplicate">IGNORE</property>
    <property name="suppressWarningCoercionOfDataElements">false</property>
    <property name="storeOriginalAttributes">true</property>
    <property name="modifyingSystem">DCM4CHEE</property>
  </bean>

  <!-- The Rename File Path Format -->
  <!-- Uncomment to activate renaming of received objects after parsing -->
  <!--
  <bean name="RenameFilePathFormat" class="org.dcm4che.util.AttributesFormat">
    <constructor>
      <parameter>date:yyyy/MM/dd(0008,0020)/date:HH(0008,0030)/#(0020,000D)/#(0020,000E)/#(0008,0018)</parameter>
    </constructor>
    <install bean="Device" method="setProperty">
      <parameter>Storage.renameFilePathFormat</parameter>
      <parameter><this/></parameter>
    </install>
  </bean>
  -->

  <!-- The DICOM Device -->
  <bean name="Device" class="org.dcm4che.net.Device">
    <constructor>
      <parameter>dcm4chee-arc</parameter>
    </constructor>
    <property name="executor">
      <inject bean="Executer" />
    </property>
    <property name="scheduledExecutor">
      <inject bean="ScheduledExecutorService" />
    </property>
    <incallback method="addApplicationEntity" />
    <uncallback method="removeApplicationEntity" />
    <install method="setProperty">
      <parameter>Storage.StoreParam</parameter>
      <parameter><inject bean="StoreParam" /></parameter>
    </install>
    <install method="setProperty">
      <parameter>Storage.fsGroupID</parameter>
      <parameter>DEFAULT</parameter>
    </install>
    <install method="setProperty">
      <parameter>Storage.directoryPath</parameter>
      <parameter>incoming</parameter>
    </install>
    <install method="setProperty">
      <parameter>Storage.digestAlgorithm</parameter>
      <parameter>MD5</parameter>
    </install>
    <install method="setProperty">
      <parameter>Query.matchUnknown</parameter>
      <parameter><inject bean="True"/></parameter>
    </install>
    <install method="setProperty">
      <parameter>Retrieve.sendPendingCGet</parameter>
      <parameter><inject bean="True"/></parameter>
    </install>
    <install method="setProperty">
      <parameter>Retrieve.sendPendingCMoveInterval</parameter>
      <parameter>
        <javabean xmlns="urn:jboss:javabean:2.0" class="java.lang.Long">
          <constructor>
            <property name="anLong">5000</property>
          </constructor>
        </javabean>
      </parameter>
    </install>
    <install method="setProperty">
      <parameter>Retrieve.connections</parameter>
      <parameter>
        <map keyClass="java.lang.String" valueClass="org.dcm4che.net.Connection">
          <entry>
            <key>STORESCP</key>
            <value>
              <bean class="org.dcm4che.net.Connection">
                <property name="hostname">localhost</property>
                <property name="port">11113</property>
              </bean>
            </value>
          </entry>
          <entry>
            <key>STORESCP_TLS</key>
            <value>
              <bean class="org.dcm4che.net.Connection">
                <property name="hostname">localhost</property>
                <property name="port">2762</property>
                <property name="tlsCipherSuite">
                  <array>
                    <value>SSL_RSA_WITH_NULL_SHA</value>
                    <value>TLS_RSA_WITH_AES_128_CBC_SHA</value>
                    <value>TLS_RSA_WITH_3DES_EDE_CBC_SHA</value>
                  </array>
                </property>
              </bean>
            </value>
          </entry>
        </map>
      </parameter>
    </install>
    <start method="activate" />
    <stop method="deactivate" />
    <demand>Class:org.dcm4chee.archive.ejb.store.InstanceStore</demand>
    <demand>Class:org.dcm4chee.archive.ejb.query.CompositeQuery</demand>
    <demand>Class:org.dcm4chee.archive.ejb.query.LocateInstances</demand>
  </bean>


  <!-- The DICOM Connection -->
  <bean name="Connection" class="org.dcm4che.net.Connection">
    <property name="port">11112</property>
    <install bean="Device" method="addConnection">
      <parameter><this/></parameter>
    </install>
    <install bean="ApplicationEntity" method="addConnection">
      <parameter><this/></parameter>
    </install>
    <uninstall bean="ApplicationEntity" method="removeConnection">
      <parameter><this/></parameter>
    </uninstall>
    <uninstall bean="Device" method="removeConnection">
      <parameter><this/></parameter>
    </uninstall>
  </bean>

  <!-- The DICOM Application Entity -->
  <bean name="ApplicationEntity" class="org.dcm4che.net.ApplicationEntity">
    <constructor>
      <parameter>DCM4CHEE</parameter>
    </constructor>
    <property name="associationAcceptor">true</property>
    <property name="maxOpsPerformed">0</property>
    <property name="maxOpsInvoked">0</property>
    <property name="dimseRQHandler">
      <inject bean="DicomServiceRegistry" />
    </property>
    <incallback method="addConnection" />
    <incallback method="addTransferCapability" />
  </bean>

  <!-- Service Registry -->
  <bean name="DicomServiceRegistry" class="org.dcm4che.net.service.DicomServiceRegistry">
    <incallback method="addDicomService" />
  </bean>

</deployment>
